# 账芽 MVP 开发任务拆解（可排期）

## 1. 说明

- 基于文档：`docs/accounting-prd-mvp.md`
- 估算单位：人天（1 人天 = 1 名开发有效工作日）
- 团队假设：1 前端 + 1 后端（或 1 全栈串行执行）
- 优先级：`P0` 必做，`P1` 本期可选优化

## 2. 任务总览（按依赖顺序）

| ID | 模块 | 优先级 | 负责人 | 预计人天 | 前置依赖 |
|---|---|---|---|---:|---|
| T1 | 数据模型与 Schema 落地 | P0 | BE | 1.5 | 无 |
| T2 | 鉴权接入与数据隔离中间层 | P0 | BE | 1.0 | T1 |
| T3 | 账本初始化（默认账本/分类） | P0 | BE | 1.0 | T2 |
| T4 | 账户模块 API（CRUD + 余额调整） | P0 | BE | 2.0 | T3 |
| T5 | 分类模块 API（CRUD） | P0 | BE | 1.5 | T3 |
| T6 | 流水模块 API（收入/支出/转账） | P0 | BE | 3.0 | T4,T5 |
| T7 | 报表 API（月汇总/分类占比/趋势） | P0 | BE | 2.5 | T6 |
| T8 | 页面骨架与路由接入 | P0 | FE | 1.5 | 无 |
| T9 | 账户管理页（列表/新建/编辑） | P0 | FE | 2.0 | T4,T8 |
| T10 | 分类管理页（列表/新建/编辑） | P0 | FE | 1.5 | T5,T8 |
| T11 | 新增流水页（收入/支出/转账） | P0 | FE | 2.5 | T6,T8 |
| T12 | 流水列表页（筛选/搜索/分页） | P0 | FE | 2.5 | T6,T8 |
| T13 | 仪表盘与报表页联动 | P0 | FE | 2.0 | T7,T8 |
| T14 | 联调与缺陷修复 | P0 | FE+BE | 2.0 | T4-T13 |
| T15 | 埋点与基础运营指标 | P1 | FE+BE | 1.0 | T14 |

合计（P0）：24.0 人天  
合计（P0+P1）：25.0 人天

## 3. 任务明细

### T1 数据模型与 Schema 落地

- 目标：定义 `ledger/account/category/transaction` 表结构与索引。
- 交付物：
- `convex/schema.ts` 完成核心表结构与字段约束
- 为常用查询补充索引（如 `userId`、`ledgerId + occurredAt`）
- 验收标准：
- 类型生成通过，`npx tsc --noEmit` 无错误
- 关键字段（金额、时间、类型）具备明确约束

### T2 鉴权接入与数据隔离中间层

- 目标：统一获取当前用户并校验资源归属。
- 交付物：
- 通用校验函数：`requireAuth`、`ensureLedgerOwner`
- 所有 mutation/query 走统一鉴权流程
- 验收标准：
- 未登录请求被拒绝
- 非本人 `ledgerId` 请求被拒绝

### T3 账本初始化（默认账本/分类）

- 目标：首次登录可立即记账。
- 交付物：
- `ledgers.ensureDefault()` + 默认分类初始化
- 幂等处理（重复调用不重复创建）
- 验收标准：
- 新用户首次进入仪表盘时自动具备可用账本与分类

### T4 账户模块 API（CRUD + 余额调整）

- 目标：支持账户基础管理与余额维护。
- 交付物：
- `accounts.list/create/update/adjustBalance`
- 余额调整写入原因字段（审计基础）
- 验收标准：
- 新建/编辑/停用账户可用
- 余额调整后查询结果一致

### T5 分类模块 API（CRUD）

- 目标：支持收入/支出分类管理。
- 交付物：
- `categories.list/create/update`
- 系统分类与自定义分类区分
- 验收标准：
- 分类可按类型过滤
- 停用分类不可用于新增流水

### T6 流水模块 API（收入/支出/转账）

- 目标：完成记账闭环核心能力。
- 交付物：
- `transactions.createExpense/createIncome/createTransfer/update/remove/list`
- 转账原子性处理（转出扣减+转入增加）
- 验收标准：
- 收入/支出写入成功并联动余额
- 转账任一步失败时整体回滚

### T7 报表 API（月汇总/分类占比/趋势）

- 目标：支持复盘可视化数据源。
- 交付物：
- `reports.monthlySummary/categoryBreakdown/trend`
- 时间区间参数与粒度参数校验
- 验收标准：
- 汇总结果与流水聚合一致
- 同一时间区间重复查询结果稳定

### T8 页面骨架与路由接入

- 目标：完成 MVP 路由与布局入口。
- 交付物：
- 新增页面路由：`transactions/new/accounts/categories/reports`
- 侧边栏导航接入
- 验收标准：
- 页面可访问，未登录受保护

### T9 账户管理页（列表/新建/编辑）

- 目标：在 UI 可完成账户管理。
- 交付物：
- 账户列表、创建弹窗、编辑弹窗、停用动作
- 表单校验与错误提示
- 验收标准：
- 正常链路无阻断，异常提示可读

### T10 分类管理页（列表/新建/编辑）

- 目标：在 UI 可完成分类管理。
- 交付物：
- 收入/支出分类切换视图
- 新建、编辑、停用
- 验收标准：
- 已停用分类在记账表单中不可选

### T11 新增流水页（收入/支出/转账）

- 目标：10 秒内完成一笔基础记账。
- 交付物：
- 类型切换、金额输入、账户/分类选择、时间选择、备注
- 提交成功后跳转或 toast 提示
- 验收标准：
- 提交后列表可见且余额联动正确

### T12 流水列表页（筛选/搜索/分页）

- 目标：支持快速查找与复核。
- 交付物：
- 筛选条件（账户/分类/时间区间/金额区间）
- 关键词搜索（备注）
- 分页或无限加载
- 验收标准：
- 多条件组合筛选结果正确

### T13 仪表盘与报表页联动

- 目标：形成“记账-复盘”闭环。
- 交付物：
- 本月收入/支出/结余卡片
- 分类占比图、趋势图
- 验收标准：
- 报表与流水数据一致

### T14 联调与缺陷修复

- 目标：消除阻断上线的问题。
- 交付物：
- P0 缺陷清单与修复记录
- 关键流程回归（登录、记账、筛选、报表）
- 验收标准：
- P0 缺陷清零

### T15 埋点与基础运营指标（P1）

- 目标：可评估 MVP 真实效果。
- 交付物：
- 关键事件埋点（首次记账、记账成功、报表查看）
- 简单看板或日志查询口径文档
- 验收标准：
- 可按日查看关键事件趋势

## 4. 建议并行方式

1. 后端先行 3 天
- T1-T4，确保前端能尽早联调账户与基础对象

2. 前端提前搭骨架
- T8 可与 T1-T4 并行

3. 中期联调
- T9-T12 与 T6 并行推进

4. 收尾阶段
- T13-T14 集中处理一致性与体验

## 5. 风险与缓解

1. 风险：转账一致性导致余额异常
- 缓解：T6 强制原子写入，失败即回滚

2. 风险：筛选查询性能下降
- 缓解：T1 增加索引，T12 控制分页大小

3. 风险：权限绕过造成数据泄露
- 缓解：T2 抽象统一校验，禁止页面层信任 `ledgerId`

## 6. Definition of Done（MVP）

1. `P0` 任务全部完成并通过验收。
2. 主流程手测通过：登录 -> 建账户 -> 记账 -> 筛选 -> 看报表。
3. 类型检查与 lint 通过：`npx tsc --noEmit`、`npm run lint`。
4. 无阻断上线的 P0 缺陷。
